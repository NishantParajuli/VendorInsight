{% block content %}
<h2>Vendor Analytics</h2>

<div>
    <h3>Sales Prediction by Category</h3>
    {% for category, data in category_sales_predictions.items %}
        <div>
            <h4>{{ category }}</h4>
            <canvas id="salesChart_{{ category }}"></canvas>
        </div>
    {% endfor %}
</div>
<h4>Product Sentiment Analysis</h4>
{% for product in product_sentiment_data %}
    <div>
        <h5>{{ product.name }}</h5>
        <p>Sadness: {{ product.sadness }}</p>
        <p>Joy: {{ product.joy }}</p>
        <p>Love: {{ product.love }}</p>
        <p>Anger: {{ product.anger }}</p>
        <p>Fear: {{ product.fear }}</p>
        <p>Surprise: {{ product.surprise }}</p>
    </div>
{% endfor %}

<h4>Overall Vendor Sentiment</h4>
<div>
    {% for sentiment in overall_sentiment_counts %}
        <p>{{ sentiment.sentiment }}: {{ sentiment.total }}</p>
    {% endfor %}
</div>
<div>
    <h3>Customer Segmentation</h3>
    <table>
        <thead>
            <tr>
                <th>User ID</th>
                <th>Age</th>
                <th>Total Order Amount</th>
                <th>Order Frequency</th>
                <th>Gender</th>
                <th>Most Ordered Category</th>
                <th>Cluster</th>
            </tr>
        </thead>
        <tbody>
            {% for customer in customer_segmentation %}
            <tr>
                <td>{{ customer.user_id }}</td>
                <td>{{ customer.age }}</td>
                <td>{{ customer.total_order_amount }}</td>
                <td>{{ customer.order_frequency }}</td>
                <td>{{ customer.gender }}</td>
                <td>{{ customer.most_ordered_category }}</td>
                <td>{{ customer.cluster }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div>
    <h3>Inventory Management</h3>
    <table>
        <thead>
            <tr>
                <th>Product</th>
                <th>Current Stock</th>
                <th>Safety Stock Level</th>
                <th>Reorder Point</th>
                <th>Future Predictions</th>
            </tr>
        </thead>
        <tbody>
            {% for item in inventory_data %}
            <tr>
                <td>{{ item.product_name }}</td>
                <td>{{ item.current_stock }}</td>
                <td>{{ item.safety_stock_level }}</td>
                <td>{{ item.reorder_point }}</td>
                <td>
                    {% comment %} seven days of future predictions in a list {% endcomment %}
                    {{ item.future_predictions}}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    

    // Sales prediction charts for each category
    {% for category, data in category_sales_predictions.items %}
        var salesDates_{{ category }} = {{ data.dates|safe }};
        var salesPredictions_{{ category }} = {{ data.predictions|safe }};
        var salesChart_{{ category }} = new Chart(document.getElementById('salesChart_{{ category }}'), {
            type: 'line',
            data: {
                labels: salesDates_{{ category }},
                datasets: [{
                    label: 'Sales Predictions for {{ category }}',
                    data: salesPredictions_{{ category }},
                    backgroundColor: 'rgba(75, 192, 192, 0.2)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    {% endfor %}
</script>
{% endblock %}